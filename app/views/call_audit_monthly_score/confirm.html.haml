= form_for @call_audit_monthly_score_entry,:url => {:action => "create"}  do |f|
  = hidden_field_tag "answer_fields", params["1"].to_json
  .seal-module.seal-panel.panel.panel-default.large
    .panel-heading
      %h3.panel-title Call Audit Monthly Score Entry
    %a#go_back_to_edit{class:"btn btn-mini btn-info pull-right"} Edit
    .panel-body
      %table{style:"width:50%"}
        %tr
          %td 
            %b
              CSS:
          %td
            = "#{current_employee.first_name} #{current_employee.last_name}"
            = hidden_field_tag "call_audit_monthly_score_entry[css_id]", params[:call_audit_month][:css_id]
            = hidden_field_tag "call_audit_monthly_score_entry[reviewer_id]",current_employee.id
            = hidden_field_tag "call_audit_monthly_score_entry[business_unit_id]", params[:business_unit_id]
        %tr
          %td 
            %b
              Month:
          %td
            = "#{DateTime.parse(params[:call_audit_month][:call_date]).strftime('%B %Y')}"
            = hidden_field_tag "call_audit_monthly_score_entry[calls_date]", DateTime.parse(params[:call_audit_month][:call_date])
        %tr
          %td 
            %b
              Date Review:
          %td
            = Time.now.strftime('%m/%d/%Y')
            = hidden_field_tag "call_audit_monthly_score_entry[review]",Time.now
        %tr
          %td
            %b
              Reviewer:
          %td
            = "#{current_employee.first_name} #{current_employee.last_name}"
          %td
            %b 
              \# of Calls This Month:
          %td
            = params[:call_audit_month][:calls_count].first
            = hidden_field_tag "call_audit_monthly_score_entry[calls_count]",params[:call_audit_month][:calls_count].first
      %table.table{:class=>"upper_call_block"}
        %tr
          %th Call Audit Scores
          %th #Calls
          %th #Reviewed
          - @question_header_call.each do |header|
            %th 
              = header.question
          %th Composite Score
        %tr
          %td 
            %b 
              Current Month
          %td 
            = "#{@call_audit_entries_current_month.count}"
          %td 
            = "reviewed"
          - @question_header_call.each do |header|
            %td 
              = mean_for_question @call_audit_entries_current_month,header.id
          %td 
            = "Composite Score"
        %tr
          %td 
            %b
              Previous Month
          %td 
            = "#{@call_audit_entries_previous_month.count}"
          %td 
            = "reviewed"
          - @question_header_call.each do |header|
            %td 
              = mean_for_question @call_audit_entries_previous_month,header.id
          %td 
            = "Composite Score"
      .confirm_block.panel-body
        %table.table
          %tr
            %th Category
            %th Grade 1-5
            %th Notes
          - params["1"].each do |question|
            %tr
              %td
                = question[1][:question]
              %td 
                = question[1][:grade]
              %td
                = question[1][:notes]
        = link_to "Next", "#", :class => "btn btn-default btn-sm btn-info pull-right", :id => "confirm_block_id"
      .summary_block.panel-body{style: "display:none;"}
        %div
          %div{:class=>"summary_adjust"}
            %table.table
              %tr
                %h3.text-center
                  %b
                    Summary
              %tr
                %th Category
                %th Grade
                %th Weight
                %th Score
                %th Possible
                %th Percent
              - weight_num = (-1)
              - tab = 0
              - score_total = 0
              - possible_total = 0
              - percent_total = 0
              - params["1"].each do |question|
                -weight_num +=1
                -tab +=1
                %tr
                  %td
                    = question[1][:question]
                  %td 
                    = question[1][:grade]
                  %td
                    = question[1][:weight]
                  %td
                    - score = question[1][:grade].to_i * question[1][:weight].to_i
                    = score
                    - score_total += score
                  %td
                    - possible_score = 5 * question[1][:weight].to_i
                    = possible_score
                    - possible_total += possible_score
                  %td
                    - percent = (score*100)/possible_score
                    = percent
                    - percent_total += percent
              %tr
                %td
                  Total
                %td
                
                %td
              
                %td
                  =score_total
                  = hidden_field_tag "call_audit_monthly_score_entry[monthly_total_score]",score_total
                %td
                  =possible_total
                  = hidden_field_tag "call_audit_monthly_score_entry[monthly_total_possible_score]",possible_total
                %td
                  - overall = (percent_total/params["1"].count)
                  = overall
                  = hidden_field_tag "call_audit_monthly_score_entry[monthly_overall_score]",overall
        %div
          %h1.text-center.pull-right.header-adjust
            %b
              OVERALL SCORE
              %br
              = overall.to_s + "%"
      %div.summary_block{style: "display:none;"}
        %table{style:"width:70%;"}
          %tr
            %td
              = text_area_tag 'comment', nil, size: "92x2",:class=>"com-fix",placeholder: "Comment";
              = text_area_tag 'strengths', nil, size: "92x2",:class=>"com-fix-one",placeholder: "Strengths";
              = text_area_tag 'development_needs', nil, size: "92x2",:class=>"com-fix-one pull-right",splaceholder: "Development Needs"
        %br
        = link_to "Prev", "#", :class => "btn btn-mini btn-success pull-left", :id => "back_to_confirm_block", :style => "margin-left:15px;" 
        = submit_tag "Continue", :class=>"btn btn-default btn-sm btn-info pull-right", :id => "submit_to_filter_audit", :style => "margin-left:12%"
           
